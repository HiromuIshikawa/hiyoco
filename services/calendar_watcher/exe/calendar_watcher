#!/usr/bin/env ruby
# frozen_string_literal: true

#
# This file was generated by Bundler.
#
# The application 'goohub' is installed as part of a gem, and
# this file is here to facilitate running it.
#

require "pathname"
ENV["BUNDLE_GEMFILE"] ||= File.expand_path("../../Gemfile",
  Pathname.new(__FILE__).realpath)

bundle_binstub = File.expand_path("../bundle", __FILE__)

if File.file?(bundle_binstub)
  if File.read(bundle_binstub, 150) =~ /This file was generated by Bundler/
    load(bundle_binstub)
  else
    abort("Your `bin/bundle` was not generated by Bundler, so this binstub cannot run.
Replace `bin/bundle` by running `bundle binstubs bundler --force`, then run this command again.")
  end
end

this_dir = File.expand_path(File.dirname(__FILE__))
lib_dir = File.join(this_dir, '../lib/proto')
$LOAD_PATH.unshift(lib_dir) unless $LOAD_PATH.include?(lib_dir)

require "rubygems"
require "bundler/setup"
require "grpc"
require "google/protobuf/well_known_types"
require "hiyoco/calendar_watcher/service_services_pb"

load Gem.bin_path("calendar_watcher", "goohub")

def create_date(time)
  gtime = Google::Protobuf::Timestamp.new
  gtime.from_time(time)

  d = Hiyoco::Calendar::Date.new(date: gtime)

  date_or_time = Hiyoco::Calendar::DateOrTime.new
  date_or_time.date = d

  return date_or_time
end

def main
  stub = Hiyoco::CalendarWatcher::Sounder::Stub.new('localhost:50051', :this_channel_is_insecure)

  s = create_date(Time.now)
  e = create_date(Time.now + 600)

  ev = Hiyoco::Calendar::Event.new(start: s, end: e, summary: "test", description: "testdesc")
  message = stub.say_event(ev).result
  puts message

end
